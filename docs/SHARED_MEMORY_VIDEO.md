# å…±äº«å†…å­˜æµ‹è¯•è§†é¢‘æ’­æ”¾å™¨

è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨**å…±äº«å†…å­˜ + WebGL**åœ¨ Electron ä¸­å®ç°é«˜æ€§èƒ½è§†é¢‘æ¸²æŸ“çš„ç¤ºä¾‹é¡¹ç›®ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

- âœ… **å…±äº«å†…å­˜ä¼ è¾“**ï¼šé›¶æ‹·è´æ•°æ®ä¼ è¾“ï¼Œé€‚åˆå¤§å°ºå¯¸è§†é¢‘å¸§
- âœ… **WebGL æ¸²æŸ“**ï¼šGPU åŠ é€Ÿæ¸²æŸ“ï¼Œæ”¯æŒé«˜åˆ†è¾¨ç‡
- âœ… **åŠ¨æ€æµ‹è¯•å›¾åƒ**ï¼šRGB å½©è‰²æ¸å˜åŠ¨ç”»ï¼ˆ30fps/60fpsï¼‰
- âœ… **æ€§èƒ½ç›‘æ§**ï¼šå®æ—¶æ˜¾ç¤º FPSã€å»¶è¿Ÿã€ååé‡ç­‰æŒ‡æ ‡
- âœ… **å¤šåˆ†è¾¨ç‡æ”¯æŒ**ï¼š1080p / 2K / 4K / 8K

## ğŸ“¦ ç¼–è¯‘ Native Addon

é¦–å…ˆéœ€è¦ç¼–è¯‘å…±äº«å†…å­˜ Native Addonï¼š

```bash
# è¿›å…¥ native addon ç›®å½•
cd native/shared-memory

# å®‰è£…ä¾èµ–
npm install

# ç¼–è¯‘ï¼ˆä½¿ç”¨ electron çš„å¤´æ–‡ä»¶ï¼‰
npx node-gyp rebuild --target=30.0.9 --arch=x64 --dist-url=https://electronjs.org/headers

# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ../..
```

> **æ³¨æ„**ï¼š`--target` ç‰ˆæœ¬éœ€è¦ä¸ä½ çš„ Electron ç‰ˆæœ¬åŒ¹é…ï¼Œå¯ä»¥åœ¨ `package.json` ä¸­æŸ¥çœ‹ã€‚

## ğŸš€ è¿è¡Œé¡¹ç›®

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
yarn run dev

# æˆ–
npm run dev
```

## ğŸ¬ ä½¿ç”¨æ–¹æ³•

1. å¯åŠ¨åº”ç”¨åï¼Œåœ¨ä¸»çª—å£ç‚¹å‡» **"ğŸ¬ æµ‹è¯•è§†é¢‘æ’­æ”¾å™¨ (å…±äº«å†…å­˜)"** æŒ‰é’®
2. åœ¨æ–°çª—å£ä¸­é€‰æ‹©åˆ†è¾¨ç‡å’Œå¸§ç‡
3. ç‚¹å‡» **"â–¶ å¼€å§‹"** æŒ‰é’®å¯åŠ¨æµ‹è¯•è§†é¢‘
4. è§‚å¯Ÿå®æ—¶æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯

## ğŸ“Š æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»è¿›ç¨‹ (Node.js)                   â”‚
â”‚   - ç”Ÿæˆ RGB æµ‹è¯•å›¾åƒ                â”‚
â”‚   - å†™å…¥å…±äº«å†…å­˜                     â”‚
â”‚   - æŒ‰å¸§ç‡å®šæ—¶æ›´æ–°                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        å…±äº«å†…å­˜ (mmap)
        é›¶æ‹·è´ä¼ è¾“
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Preloadè„šæœ¬  â”‚ â”‚ æ¸²æŸ“è¿›ç¨‹      â”‚
â”‚ è¯»å–å…±äº«å†…å­˜ â”‚ â”‚ WebGL æ¸²æŸ“   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ å…³é”®æ–‡ä»¶

### Native Addon
- `native/shared-memory/shared_memory.cpp` - C++ å…±äº«å†…å­˜å®ç°
- `native/shared-memory/binding.gyp` - ç¼–è¯‘é…ç½®

### ä¸»è¿›ç¨‹
- `src/lib/test-video/main/index.ts` - æµ‹è¯•å›¾åƒç”Ÿæˆå™¨
- `src/lib/test-video/main/test-video-preload.ts` - Preload è„šæœ¬

### æ¸²æŸ“è¿›ç¨‹
- `src/lib/test-video/renderer/webgl-rgb-renderer.ts` - WebGL æ¸²æŸ“å™¨
- `src/lib/test-video/renderer/test-video-player.vue` - æ’­æ”¾å™¨ç»„ä»¶

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹

### 1. å…±äº«å†…å­˜
```cpp
// åˆ›å»ºå…±äº«å†…å­˜
int fd = shm_open(name, O_CREAT | O_RDWR, 0666);
void* ptr = mmap(NULL, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0);
```

### 2. WebGL çº¹ç†ä¸Šä¼ 
```typescript
gl.texImage2D(
  gl.TEXTURE_2D, 0, gl.RGB,
  width, height, 0,
  gl.RGB, gl.UNSIGNED_BYTE,
  rgbData  // ç›´æ¥ä¸Šä¼  Uint8Array
);
```

### 3. é›¶æ‹·è´è¯»å–
```typescript
const buffer = sharedMemory.read(shmName);  // Node.js Buffer
const arrayBuffer = buffer.buffer;          // ArrayBufferï¼ˆé›¶æ‹·è´ï¼‰
const uint8Array = new Uint8Array(arrayBuffer);  // è§†å›¾
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| åˆ†è¾¨ç‡ | å¸§å¤§å° | 30fps ååé‡ | 60fps ååé‡ | æ¸²æŸ“å»¶è¿Ÿ |
|--------|--------|-------------|-------------|----------|
| 1080p  | 6 MB   | ~180 MB/s   | ~360 MB/s   | 2-5 ms   |
| 2K     | 11 MB  | ~330 MB/s   | ~660 MB/s   | 3-8 ms   |
| 4K     | 24 MB  | ~720 MB/s   | ~1.4 GB/s   | 5-12 ms  |
| 8K     | 95 MB  | ~2.8 GB/s   | ~5.7 GB/s   | 10-20 ms |

## ğŸ› ï¸ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šç¼–è¯‘å¤±è´¥
```bash
# ç¡®ä¿å®‰è£…äº†ç¼–è¯‘å·¥å…·
sudo apt install build-essential  # Linux
xcode-select --install             # macOS
```

### é—®é¢˜ï¼šæ— æ³•åŠ è½½ addon
- æ£€æŸ¥ç¼–è¯‘è¾“å‡ºï¼š`native/shared-memory/build/Release/shared_memory.node` æ˜¯å¦å­˜åœ¨
- ç¡®è®¤ Electron ç‰ˆæœ¬åŒ¹é…
- æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### é—®é¢˜ï¼šæ€§èƒ½ä¸ä½³
- é™ä½åˆ†è¾¨ç‡æˆ–å¸§ç‡
- æ£€æŸ¥ GPU é©±åŠ¨æ˜¯å¦æ­£å¸¸
- å…³é—­å…¶ä»–å ç”¨ GPU çš„ç¨‹åº

## ğŸš€ ä¸‹ä¸€æ­¥ï¼šæ¥å…¥çœŸå®è§†é¢‘è§£ç 

è¦æ›¿æ¢ä¸ºçœŸå®çš„è§†é¢‘è§£ç å™¨ï¼š

1. **ä½¿ç”¨ FFmpeg**ï¼š
   ```cpp
   AVCodecContext* codec_ctx = avcodec_alloc_context3(codec);
   av_hwdevice_ctx_create(&hw_device_ctx, AV_HWDEVICE_TYPE_CUDA, ...);
   ```

2. **ç¡¬ä»¶åŠ é€Ÿ**ï¼š
   - NVIDIA: NVDEC (CUDA)
   - Intel: QSV
   - AMD: AMF
   - Linux: VAAPI

3. **YUV æ”¯æŒ**ï¼šä¿®æ”¹ WebGL æ¸²æŸ“å™¨ä½¿ç”¨ YUVâ†’RGB ç€è‰²å™¨

## ğŸ“ è®¸å¯è¯

MIT License
